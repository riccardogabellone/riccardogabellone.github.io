<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riccardo Gabellone - Profile</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="icon" href="/favicon.png" type="image/png">
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Base styles for the permanent dark theme */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827;
            /* bg-gray-900 */
            color: #e5e7eb;
            /* text-gray-200 */
        }

        .material-symbols-outlined {
            vertical-align: middle;
            font-size: 1.25em;
            line-height: 1;
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        .material-symbols-outlined.filled {
            font-variation-settings: 'FILL' 1;
        }

        /* Loading Placeholder */
        .loading-placeholder::after {
            content: "...";
            display: inline-block;
            animation: loading-dots 1s infinite steps(3, end);
            color: #9ca3af;
        }

        @keyframes loading-dots {

            0%,
            20% {
                content: ".";
            }

            40% {
                content: "..";
            }

            60%,
            100% {
                content: "...";
            }
        }

        /* Timeline Styles (Dark) */
        .timeline-item {
            position: relative;
            padding-bottom: 2rem;
            padding-left: 2.5rem;
        }

        .timeline-item:last-child {
            padding-bottom: 0;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 0.25rem;
            bottom: 0;
            width: 2px;
            background-color: #4b5563;
            /* bg-gray-600 */
        }

        .timeline-item:last-child::before {
            height: 0.5rem;
        }

        .timeline-marker {
            position: absolute;
            left: 0;
            top: 0.125rem;
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            background-color: #a855f7;
            /* bg-purple-500 */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .timeline-marker .material-symbols-outlined {
            font-size: 0.875rem;
            color: #ffffff;
            /* text-white */
        }

        /* Language bar styles (Dark) */
        .language-bar-container {
            margin-top: 0.75rem;
        }

        .language-item {
            margin-bottom: 0.75rem;
        }

        .language-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }

        .language-progress-bg {
            width: 100%;
            border-radius: 9999px;
            height: 0.625rem;
            overflow: hidden;
            background-color: #374151;
            /* bg-gray-700 */
        }

        .language-progress-bar {
            height: 100%;
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
            /* Using the purple from the script for consistency */
            background-color: #8b5cf6;
            /* bg-purple-600 (consistent with script) */
        }

        /* Contribution Calendar Styles (Dracula Theme for grid, M3 Dark for container/chips) */
        .calendar-container {
            background-color: #181818;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            /* Remove overflow-x: auto; */
            border: 1px solid #282a36;
            /* Add overflow hidden to the main container */
            overflow: hidden;
            position: relative;
            /* Needed for absolute positioning or transform origins */
            cursor: grab;
            /* Indicate grabbable */
        }

        .calendar-container.grabbing {
            cursor: grabbing;
        }

        .calendar-grid-container {
            /* This container might not be strictly necessary anymore,
               but keep it for structure or remove if simplifying */
            margin-top: 0.5rem;
            width: 100%;
            /* Ensure it takes full width */
            height: 115px;
            /* Set a fixed height for the viewport */
            overflow: hidden;
            /* Crucial: hide overflowing grid */
            position: relative;
            /* For positioning the transform wrapper */
        }

        /* New wrapper for transformations */
        .calendar-transform-wrapper {
            width: max-content;
            /* Allow it to be as wide as the grid */
            height: max-content;
            /* Allow it to be as tall as the grid */
            /* transform-origin: top left; */
            /* Set initial origin */
            /* transform will be applied by JS */
            will-change: transform;
            /* Optimize rendering */
            position: absolute;
            /* Allow positioning within grid-container */
            top: 0;
            left: 0;
        }

        .calendar-grid {
            display: grid;
            grid-template-rows: repeat(7, 12px);
            grid-auto-flow: column;
            grid-auto-columns: 12px;
            gap: 3px;
            width: max-content;
            /* Grid determines its own size */
            /* No position absolute needed here */
        }

        .calendar-cell {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            background-color: #282a36;
        }

        .calendar-cell:hover {
            outline: 1px solid #f8f8f2;
        }

        /* Year Chips Styles */
        .year-chip {
            display: inline-block;
            font-size: 0.75rem;
            /* text-xs */
            line-height: 1rem;
            font-weight: 500;
            /* font-medium */
            padding-left: 0.75rem;
            /* px-3 */
            padding-right: 0.75rem;
            /* px-3 */
            padding-top: 0.25rem;
            /* py-1 */
            padding-bottom: 0.25rem;
            /* py-1 */
            border-radius: 9999px;
            /* rounded-full */
            cursor: pointer;
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 200ms;
            background-color: rgba(88, 28, 135, 0.5);
            /* bg-purple-900 bg-opacity-50 */
            color: #e9d5ff;
            /* text-purple-200 */
            border: none;
            /* Ensure button default border is removed */
            text-align: center;
        }

        .year-chip.selected {
            background-color: #8b5cf6;
            /* bg-purple-600 */
            color: #ffffff;
            /* text-white */
            cursor: default;
        }

        .year-chip.total {
            background-color: #4b5563;
            /* bg-gray-600 */
            color: #e5e7eb;
            /* text-gray-200 */
            cursor: default;
            align-content: center;
        }

        .year-chip:not(.selected):not(.total):hover {
            background-color: rgba(107, 33, 168, 0.7);
            /* bg-purple-800 bg-opacity-70 */
        }

        /* Link Chip Hover Style */
        a.link-chip-hover {
            display: inline-block;
            text-decoration: none;
            color: inherit;
            border-radius: 9999px;
            padding-left: 0.75rem;
            padding-right: 0.75rem;
            padding-top: 0.125rem;
            padding-bottom: 0.125rem;
            margin: -0.125rem -0.75rem;
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 200ms;
        }

        a.link-chip-hover:hover {
            background-color: rgba(107, 33, 168, 0.7);
            color: #e9d5ff;
            text-decoration: underline;
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-200">

    <div class="container mx-auto max-w-7xl p-4 md:p-8">

        <header
            class="mb-12 rounded-lg p-6 md:p-8 shadow-lg flex flex-col md:flex-row items-center relative bg-gray-800 border border-gray-700">
            <div class="mb-4 md:mb-0 md:mr-8">
                <img id="profile-pic" src="https://placehold.co/128x128/3730a3/e0e7ff?text=Me" alt="Profile Picture"
                    class="w-24 h-24 md:w-32 md:h-32 rounded-full border-4 border-purple-800 object-cover bg-gray-700">
            </div>
            <div class="text-center md:text-left flex-grow">
                <h1 id="profile-name" class="text-3xl md:text-4xl font-bold text-gray-200 loading-placeholder">...</h1>
                <p id="profile-title" class="text-xl text-gray-400 mb-4">Software Engineer</p>
                <div class="flex justify-center md:justify-start space-x-4 text-gray-400">
                    <a id="github-link" href="https://github.com/riccardogabellone" target="_blank"
                        rel="noopener noreferrer" class="hover:text-purple-400 transition-colors"
                        aria-label="GitHub Profile"> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6"
                            fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                        </svg> </a>
                    <a id="linkedin-link" href="https://linkedin.com/in/riccardogabellone" target="_blank"
                        rel="noopener noreferrer" class="hover:text-purple-400 transition-colors"
                        aria-label="LinkedIn Profile"> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6"
                            fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" />
                        </svg> </a>
                    <a id="x-link" href="https://x.com/GabelloneRic" target="_blank" rel="noopener noreferrer"
                        class="hover:text-purple-400 transition-colors" aria-label="X Profile"> <svg
                            xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 16 16">
                            <path
                                d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865l8.875 11.633Z" />
                        </svg> </a>
                    <a id="email-link" href="mailto:ing.riccardogabellone@gmail.com"
                        class="hover:text-purple-400 transition-colors" aria-label="Email Me"> <span
                            class="material-symbols-outlined">mail</span> </a>
                </div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-7 gap-8">
            <div class="lg:col-span-5 space-y-8">
                <section id="bio" class="rounded-lg p-6 shadow-lg bg-gray-800 border border-gray-700">
                    <h2 class="text-2xl font-semibold mb-4 text-purple-400 flex items-center"> <span
                            class="material-symbols-outlined mr-2">person</span> About Me </h2>
                    <p id="profile-bio" class="prose prose-invert max-w-none text-gray-300 loading-placeholder">...</p>
                </section>

                <section id="github-stats" class="rounded-lg p-6 shadow-lg bg-gray-800 border border-gray-700">
                    <h2 class="text-2xl font-semibold mb-4 text-purple-400 flex items-center"> <span
                            class="material-symbols-outlined mr-2">monitoring</span> GitHub Statistics </h2>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6 text-center">
                        <div class="bg-gray-700 p-4 rounded-md">
                            <div id="commits-count" class="text-3xl font-bold text-purple-400 loading-placeholder">...
                            </div>
                            <div class="text-sm text-gray-400">Total Commits</div>
                        </div>
                        <div class="bg-gray-700 p-4 rounded-md">
                            <div id="owned-repo-count" class="text-3xl font-bold text-purple-400 loading-placeholder">
                                ...</div>
                            <div class="text-sm text-gray-400">Owned Repos</div>
                        </div>
                        <div class="bg-gray-700 p-4 rounded-md">
                            <div id="contributed-repos-count"
                                class="text-3xl font-bold text-purple-400 loading-placeholder">...</div>
                            <div class="text-sm text-gray-400">Contributed Repos</div>
                        </div>
                        <div class="bg-gray-700 p-4 rounded-md">
                            <div id="pr-count" class="text-3xl font-bold text-purple-400 loading-placeholder">...</div>
                            <div class="text-sm text-gray-400">Pull Requests</div>
                        </div>
                        <div class="bg-gray-700 p-4 rounded-md">
                            <div id="issues-count" class="text-3xl font-bold text-purple-400 loading-placeholder">...
                            </div>
                            <div class="text-sm text-gray-400">Issues</div>
                        </div>
                        <div class="bg-gray-700 p-4 rounded-md">
                            <div id="followers-count" class="text-3xl font-bold text-purple-400 loading-placeholder">...
                            </div>
                            <div class="text-sm text-gray-400">Followers</div>
                        </div>
                        <!-- <div class="bg-gray-700 p-4 rounded-md md:col-start-2">
                            <div id="gists-count" class="text-3xl font-bold text-purple-400 loading-placeholder">...
                            </div>
                            <div class="text-sm text-gray-400">Public Gists</div>
                        </div> -->
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2 text-gray-400">Contribution Activity</h3>
                        <div id="contribution-calendar-container"
                            class="calendar-container min-h-[200px] flex flex-col items-center justify-center">
                            <!-- Renamed placeholder to be the viewport -->
                            <div id="calendar-viewport"
                                class="calendar-grid-container w-full min-h-[115px] my-4 flex items-center justify-center">
                                <!-- Add the transform wrapper inside -->
                                <div id="calendar-transform-wrapper" class="calendar-transform-wrapper">
                                    <!-- Grid will be inserted here by JS -->
                                    <p id="calendar-loading-text"
                                        class="loading-placeholder text-gray-400 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                                        Loading contribution grid...</p>
                                </div>
                            </div>
                            <div id="year-chips-container"
                                class="mt-4 flex flex-wrap gap-2 justify-center min-h-[30px]">
                                <p class="loading-placeholder text-gray-400 text-xs">Loading years...</p>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-gray-400">Language Breakdown (Latest 1k commits)</h3>
                        <div id="language-stats-container" class="language-bar-container">
                            <p class="text-sm text-gray-400 loading-placeholder">Loading language data...</p>
                        </div>
                    </div>
                </section>

                <!-- <section id="projects" class="rounded-lg p-6 shadow-lg bg-gray-800 border border-gray-700">
                    <h2 class="text-2xl font-semibold mb-4 text-purple-400 flex items-center">
                        <span class="material-symbols-outlined mr-2">star</span> Featured Projects
                    </h2>
                    <div id="featured-projects-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div
                            class="bg-gray-700 rounded-lg p-4 shadow-md transition-shadow hover:shadow-lg flex flex-col">
                            <h3 class="text-lg font-semibold mb-2 text-gray-200">Project Title One</h3>
                            <p class="text-sm text-gray-400 mb-3 flex-grow">A brief description...</p>
                            <div class="mb-3">
                                <span class="inline-block bg-gray-600 text-gray-300 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">Tech 1</span>
                            </div>
                            <div class="flex justify-between items-center text-sm text-gray-400">
                                <div class="flex items-center space-x-2">
                                    <span class="material-symbols-outlined text-base">star_rate</span> <span>123</span>
                                    <span class="material-symbols-outlined text-base">fork_right</span> <span>45</span>
                                </div>
                                <a href="#" target="_blank" rel="noopener noreferrer"
                                    class="text-purple-400 hover:underline font-medium flex items-center"> View Code
                                    <span class="material-symbols-outlined text-base ml-1">open_in_new</span> </a>
                            </div>
                        </div>
                    </div>
                </section> -->
            </div>

            <div class="lg:col-span-2 space-y-8">
                <section id="skills" class="rounded-lg p-6 shadow-lg bg-gray-800 border border-gray-700">
                    <h2 class="text-2xl font-semibold mb-4 text-purple-400 flex items-center"> <span
                            class="material-symbols-outlined mr-2">terminal</span> Skills & Tech stack
                    </h2>
                    <div class="flex flex-wrap gap-2">
                        <span
                            class="bg-purple-900 bg-opacity-50 text-purple-200 text-sm font-medium px-3 py-1 rounded-full">Python</span>
                        <span
                            class="bg-purple-900 bg-opacity-50 text-purple-200 text-sm font-medium px-3 py-1 rounded-full">Rust</span>
                        <span
                            class="bg-purple-900 bg-opacity-50 text-purple-200 text-sm font-medium px-3 py-1 rounded-full">PostgreSQL</span>
                        <span
                            class="bg-purple-900 bg-opacity-50 text-purple-200 text-sm font-medium px-3 py-1 rounded-full">Docker</span>
                        <span
                            class="bg-purple-900 bg-opacity-50 text-purple-200 text-sm font-medium px-3 py-1 rounded-full">K8s</span>
                        <span
                            class="bg-purple-900 bg-opacity-50 text-purple-200 text-sm font-medium px-3 py-1 rounded-full">Bash</span>
                        <span
                            class="bg-purple-900 bg-opacity-50 text-purple-200 text-sm font-medium px-3 py-1 rounded-full">Terraform</span>
                        <span
                            class="bg-purple-900 bg-opacity-50 text-purple-200 text-sm font-medium px-3 py-1 rounded-full">Kotlin</span>
                        <span
                            class="bg-purple-900 bg-opacity-50 text-purple-200 text-sm font-medium px-3 py-1 rounded-full">JavaScript</span>
                        <span
                            class="bg-purple-900 bg-opacity-50 text-purple-200 text-sm font-medium px-3 py-1 rounded-full">Flutter</span>
                    </div>
                </section>
                <section id="experience" class="rounded-lg p-6 shadow-lg bg-gray-800 border border-gray-700">
                    <h2 class="text-2xl font-semibold mb-6 text-purple-400 flex items-center">
                        <span class="material-symbols-outlined mr-2">timeline</span> Experience & Education
                    </h2>
                    <div class="relative">
                        <div class="timeline-item">
                            <div class="timeline-marker"> <span class="material-symbols-outlined">work</span> </div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-300">Software Engineer</h3>
                                <p class="text-sm text-gray-400 mb-1"><a href="https://www.boringstuff.xyz/"
                                        target="_blank" rel="noopener noreferrer"
                                        class="hover:underline text-purple-300 font-medium">Boring
                                        Stuff</a> | 2022 - Present</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-marker"><span class="material-symbols-outlined">school</span></div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-300">M.S. in Software Engineering</h3>
                                <p class="text-sm text-gray-400 mb-1">Politecnico di Torino | 2018 - 2022</p>
                                <p class="text-xs text-gray-500">Focus on software development. Thesis:
                                    Development of a mutant injection tool as part of a gamified GUI Testing
                                    environment.</p>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-marker"><span class="material-symbols-outlined">school</span></div>
                            <div class="ml-4">
                                <h3 class="text-lg font-semibold text-gray-300">B.S. in Computer Engineering</h3>
                                <p class="text-sm text-gray-400 mb-1">Politecnico di Torino | 2013 - 2018</p>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="contact"
                    class="rounded-lg p-6 shadow-lg bg-purple-900 bg-opacity-50 text-center border border-purple-800">
                    <h2 class="text-2xl font-semibold mb-3 text-purple-200">Get In Touch!</h2>
                    <a id="contact-email-button" href="mailto:ing.riccardogabellone@gmail.com"
                        class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-full shadow-sm text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-purple-500 transition-colors">
                        <span class="material-symbols-outlined mr-2">outgoing_mail</span> Email Me
                    </a>
                </section>
            </div>
        </main>

        <footer class="mt-12 text-center text-gray-400 text-sm">
            <p>&copy; <span id="current-year"></span> <span id="footer-name" class="loading-placeholder">...</span>. All
                rights reserved.</p>
            <p id="last-updated" class="text-xs mt-1">Last updated: Loading...</p>
        </footer>
    </div>

    <script>
        // Set current year in footer
        document.getElementById('current-year').textContent = new Date().getFullYear();

        // == GitHub Data Fetching ==
        const gasWebAppUrl = 'https://script.google.com/macros/s/AKfycbyzbrUmB1JTP23S1Tl8bHnIf1JnV0MMCOzdEdpJmSrZ4BW-RPBQthAEs7ghze1y3u3BXQ/exec';
        const githubUsername = 'riccardogabellone';

        // Store fetched data globally
        window.currentLanguageData = null;
        window.currentContributionData = null;
        window.selectedContributionYear = null; // Track selected year

        // --- Helper Functions ---
        function updateText(elementId, value, isPlaceholder = false) {
            const element = document.getElementById(elementId); if (!element) { console.warn(`Element ID "${elementId}" not found.`); return; } let displayValue = 'N/A'; if (value !== undefined && value !== null) { if (typeof value === 'number' && value >= 1000 && !elementId.includes('year')) { displayValue = value.toLocaleString(); } else { displayValue = value; } } element.textContent = displayValue; if (!isPlaceholder) element.classList.remove('loading-placeholder');
        }
        function updateImage(elementId, value) {
            const element = document.getElementById(elementId); if (element && value) element.src = value; else if (element) console.warn(`Image src missing for "${elementId}".`); else console.warn(`Element ID "${elementId}" not found.`);
        }

        // --- Language Stats Rendering ---
        function renderLanguageStats(languages) { /* ... (same as before) ... */
            window.currentLanguageData = languages; const container = document.getElementById('language-stats-container'); if (!container) return; if (!Array.isArray(languages) || languages.length === 0) { container.innerHTML = '<p class="text-sm text-gray-400">Language data not available.</p>'; return; } let languageHtml = ''; languages.forEach(lang => { const percentage = parseFloat(lang.percentage) || 0; const color = '#8b5cf6'; languageHtml += `<div class="language-item"><div class="language-label text-gray-300"><span>${lang.name || 'Unknown'}</span><span class="font-medium text-purple-400">${percentage.toFixed(1)}%</span></div><div class="language-progress-bg bg-gray-700"><div class="language-progress-bar" style="width: ${percentage}%; background-color: ${color};"></div></div></div>`; }); container.innerHTML = languageHtml;
        }

        // --- Contribution Chart Rendering (Single Year) ---
        const draculaTheme = { grade4: "#ff79c6", grade3: "#bd93f9", grade2: "#6272a4", grade1: "#44475a", grade0: "#282a36" };
        function getDraculaColor(intensity) { /* ... (same as before) ... */
            switch (String(intensity || '0')) { case '4': return draculaTheme.grade4; case '3': return draculaTheme.grade3; case '2': return draculaTheme.grade2; case '1': return draculaTheme.grade1; case '0': default: return draculaTheme.grade0; }
        }

        // Function to render the grid for a specific year
        function renderContributionGrid(year, allContributions) {
            const transformWrapper = document.getElementById('calendar-transform-wrapper'); // Target the transform wrapper
            const loadingText = document.getElementById('calendar-loading-text');
            if (!transformWrapper) {
                console.error("Calendar transform wrapper not found.");
                if (loadingText) loadingText.textContent = 'Error: Grid container missing.';
                return;
            }

            transformWrapper.innerHTML = ''; // Clear previous grid or loading text
            const grid = document.createElement('div');
            grid.className = 'calendar-grid';
            grid.id = 'dynamic-calendar-grid'; // Give it an ID for easier reference later

            const yearInt = parseInt(year);
            const contribMap = new Map(
                allContributions
                    .filter(c => c.date.startsWith(year))
                    .map(c => [c.date.split('T')[0], c])
            );

            const startDate = new Date(yearInt, 0, 1);
            const endDate = new Date(yearInt, 11, 31);
            const startDay = startDate.getDay(); // 0 = Sunday

            // Add padding cells before Jan 1st
            for (let i = 0; i < startDay; i++) {
                const cell = document.createElement('div');
                cell.className = 'calendar-cell invisible'; // Use invisible class if needed, or just default color
                cell.style.backgroundColor = draculaTheme.grade0; // Ensure padding has base color
                grid.appendChild(cell);
            }

            // Add cells for each day of the year
            let currentDay = new Date(startDate);
            while (currentDay <= endDate) {
                const dateString = currentDay.toISOString().split('T')[0];
                const cell = document.createElement('div');
                cell.className = 'calendar-cell';
                const dayData = contribMap.get(dateString);
                const intensity = dayData ? dayData.intensity : '0';
                cell.style.backgroundColor = getDraculaColor(intensity);
                const count = dayData ? dayData.count : 0;
                cell.setAttribute('title', `${dateString}`);
                grid.appendChild(cell);
                currentDay.setDate(currentDay.getDate() + 1);
            }
            transformWrapper.appendChild(grid); // Append the generated grid to the transform wrapper

            // Reset transform state when grid is re-rendered
            resetGridTransform();
            // Fit grid initially after rendering
            // Use requestAnimationFrame to ensure layout is calculated
            requestAnimationFrame(() => {
                fitGridToViewport();
            });
        }

        // --- Zoom/Pan Logic ---
        const calendarContainer = document.getElementById('contribution-calendar-container');
        const viewport = document.getElementById('calendar-viewport');
        const transformWrapper = document.getElementById('calendar-transform-wrapper');

        let scale = 1;
        let panning = false;
        let pointX = 0;
        let pointY = 0;
        let start = { x: 0, y: 0 };
        let currentTranslate = { x: 0, y: 0 }; // Store current translation separately

        const minScale = 0.5;
        const maxScale = 4;

        function setTransform() {
            if (transformWrapper) {
                // Ensure transform-origin is set before applying transform for consistent zoom behavior
                transformWrapper.style.transformOrigin = '0 0';
                transformWrapper.style.transform = `translate(${currentTranslate.x}px, ${currentTranslate.y}px) scale(${scale})`;
            }
        }

        function resetGridTransform() {
            scale = 1;
            currentTranslate = { x: 0, y: 0 };
            // Don't call setTransform here, let fitGridToViewport handle initial state
        }

        // Optional: Function to initially fit/center the grid
        function fitGridToViewport() {
            if (!transformWrapper || !viewport) return;
            const grid = document.getElementById('dynamic-calendar-grid');
            if (!grid) return;

            // Ensure grid has dimensions before calculating
            if (grid.offsetWidth === 0 || grid.offsetHeight === 0) {
                console.warn("Grid dimensions are zero, cannot fit to viewport yet.");
                // Retry after a short delay if dimensions aren't ready
                // setTimeout(fitGridToViewport, 50);
                return;
            }

            const viewportRect = viewport.getBoundingClientRect();
            // Use offsetWidth/offsetHeight as getBoundingClientRect might be affected by previous transforms
            const gridWidth = grid.offsetWidth;
            const gridHeight = grid.offsetHeight;


            // Calculate scale to fit width OR height, whichever requires more scaling down
            const scaleX = viewportRect.width / gridWidth;
            const scaleY = viewportRect.height / gridHeight;
            const initialScale = Math.min(scaleX, scaleY, 1); // Fit entirely, don't scale up initially

            scale = Math.max(minScale, initialScale); // Apply min scale limit

            // Center the scaled grid
            const scaledGridWidth = gridWidth * scale;
            const scaledGridHeight = gridHeight * scale;

            currentTranslate.x = (viewportRect.width - scaledGridWidth) / 2;
            currentTranslate.y = (viewportRect.height - scaledGridHeight) / 2;

            // Clamp initial translation (basic clamping) - should not be needed if fitting correctly
            // currentTranslate.x = Math.min(0, currentTranslate.x);
            // currentTranslate.y = Math.min(0, currentTranslate.y);
            currentTranslate = clampTranslate(currentTranslate.x, currentTranslate.y); // Use clamp for safety

            console.log(`Fit: scale=${scale.toFixed(2)}, translate=(${currentTranslate.x.toFixed(2)}, ${currentTranslate.y.toFixed(2)})`);
            setTransform();
        }


        function clampTranslate(newX, newY) {
            if (!transformWrapper || !viewport) return { x: newX, y: newY };
            const grid = document.getElementById('dynamic-calendar-grid');
            if (!grid || grid.offsetWidth === 0) return { x: newX, y: newY }; // Check grid exists and has width

            const viewportRect = viewport.getBoundingClientRect();
            // Use offsetWidth/Height for original dimensions
            const gridWidth = grid.offsetWidth;
            const gridHeight = grid.offsetHeight;

            const scaledGridWidth = gridWidth * scale;
            const scaledGridHeight = gridHeight * scale;

            // Calculate max translation limits
            const maxX = 0;
            const minX = viewportRect.width - scaledGridWidth;
            const maxY = 0;
            const minY = viewportRect.height - scaledGridHeight;

            // Clamp values, handle cases where scaled grid is smaller than viewport
            let clampedX = newX;
            let clampedY = newY;

            if (scaledGridWidth <= viewportRect.width) {
                // If smaller or equal width, center it or clamp between 0 and viewport width - scaled width
                clampedX = Math.max(0, Math.min(newX, viewportRect.width - scaledGridWidth));
            } else {
                // If wider, clamp between minX and maxX (which is 0)
                clampedX = Math.max(minX, Math.min(newX, maxX));
            }

            if (scaledGridHeight <= viewportRect.height) {
                // If smaller or equal height, center it or clamp between 0 and viewport height - scaled height
                clampedY = Math.max(0, Math.min(newY, viewportRect.height - scaledGridHeight));
            } else {
                // If taller, clamp between minY and maxY (which is 0)
                clampedY = Math.max(minY, Math.min(newY, maxY));
            }


            return { x: clampedX, y: clampedY };
        }


        if (calendarContainer && viewport && transformWrapper) {
            // Mouse Wheel Zoom
            viewport.onwheel = function (e) {
                e.preventDefault();
                const rect = viewport.getBoundingClientRect();
                // Calculate pointer position relative to the viewport
                const pointerX = e.clientX - rect.left;
                const pointerY = e.clientY - rect.top;

                // Calculate pointer position relative to the *unscaled*, *untranslated* element content
                const xs = (pointerX - currentTranslate.x) / scale;
                const ys = (pointerY - currentTranslate.y) / scale;

                const delta = (e.wheelDelta ? e.wheelDelta : -e.deltaY);
                const wheel = delta > 0 ? 1.1 : 1 / 1.1; // Zoom factor

                const oldScale = scale;
                scale = Math.min(maxScale, Math.max(minScale, scale * wheel));

                // Calculate the new translation needed to keep the point under the cursor fixed
                currentTranslate.x = pointerX - xs * scale;
                currentTranslate.y = pointerY - ys * scale;

                // Clamp translation after zooming
                currentTranslate = clampTranslate(currentTranslate.x, currentTranslate.y);

                setTransform();
            }

            // Mouse Panning
            viewport.onmousedown = function (e) {
                e.preventDefault();
                start = { x: e.clientX - currentTranslate.x, y: e.clientY - currentTranslate.y };
                panning = true;
                calendarContainer.classList.add('grabbing');
            }

            viewport.onmousemove = function (e) {
                if (!panning) return;
                e.preventDefault();
                const newX = e.clientX - start.x;
                const newY = e.clientY - start.y;

                // Clamp translation during panning
                const clamped = clampTranslate(newX, newY);
                currentTranslate.x = clamped.x;
                currentTranslate.y = clamped.y;

                setTransform();
            }

            viewport.onmouseup = function (e) {
                if (panning) {
                    panning = false;
                    calendarContainer.classList.remove('grabbing');
                }
            }

            viewport.onmouseleave = function (e) {
                if (panning) {
                    panning = false;
                    calendarContainer.classList.remove('grabbing');
                }
            }

            // --- Touch Events ---
            let initialDistance = null;
            let touchStartCenter = null;

            viewport.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    // Start panning
                    const touch = e.touches[0];
                    start = { x: touch.clientX - currentTranslate.x, y: touch.clientY - currentTranslate.y };
                    panning = true;
                    calendarContainer.classList.add('grabbing');
                    initialDistance = null; // Reset pinch distance
                    touchStartCenter = null;
                } else if (e.touches.length === 2) {
                    // Start pinching
                    panning = false; // Stop panning if it was active
                    calendarContainer.classList.remove('grabbing');
                    const t1 = e.touches[0];
                    const t2 = e.touches[1];
                    initialDistance = Math.hypot(t1.clientX - t2.clientX, t1.clientY - t2.clientY);
                    // Calculate center point relative to viewport for zoom origin
                    const rect = viewport.getBoundingClientRect();
                    const centerX = ((t1.clientX + t2.clientX) / 2) - rect.left;
                    const centerY = ((t1.clientY + t2.clientY) / 2) - rect.top;
                    touchStartCenter = { x: centerX, y: centerY };
                }
                // Prevent default scroll/zoom behavior
                if (e.touches.length > 0) e.preventDefault();
            }, { passive: false }); // Need passive: false to call preventDefault

            viewport.addEventListener('touchmove', (e) => {
                if (panning && e.touches.length === 1) {
                    // Panning
                    const touch = e.touches[0];
                    const newX = touch.clientX - start.x;
                    const newY = touch.clientY - start.y;
                    const clamped = clampTranslate(newX, newY);
                    currentTranslate.x = clamped.x;
                    currentTranslate.y = clamped.y;
                    setTransform();
                } else if (initialDistance !== null && touchStartCenter !== null && e.touches.length === 2) {
                    // Pinching
                    const t1 = e.touches[0];
                    const t2 = e.touches[1];
                    const currentDistance = Math.hypot(t1.clientX - t2.clientX, t1.clientY - t2.clientY);
                    const scaleFactor = currentDistance / initialDistance;

                    const oldScale = scale;
                    scale = Math.min(maxScale, Math.max(minScale, oldScale * scaleFactor));

                    // Calculate pinch center relative to the *unscaled*, *untranslated* element content
                    // touchStartCenter is already relative to viewport, adjust for current transform
                    const xs = (touchStartCenter.x - currentTranslate.x) / oldScale;
                    const ys = (touchStartCenter.y - currentTranslate.y) / oldScale;

                    // Calculate the new translation
                    currentTranslate.x = touchStartCenter.x - xs * scale;
                    currentTranslate.y = touchStartCenter.y - ys * scale;


                    // Clamp translation after zooming
                    currentTranslate = clampTranslate(currentTranslate.x, currentTranslate.y);

                    setTransform();

                    // Update initial distance for continuous zoom *relative to the new scale*
                    // This prevents acceleration issues on some devices
                    initialDistance = currentDistance;
                    // Also update the logical center point for next move event
                    const rect = viewport.getBoundingClientRect();
                    const currentCenterX = ((t1.clientX + t2.clientX) / 2) - rect.left;
                    const currentCenterY = ((t1.clientY + t2.clientY) / 2) - rect.top;
                    touchStartCenter = { x: currentCenterX, y: currentCenterY };


                }
                // Prevent default scroll/zoom behavior
                if (e.touches.length > 0) e.preventDefault();
            }, { passive: false }); // Need passive: false to call preventDefault

            viewport.addEventListener('touchend', (e) => {
                if (panning) {
                    panning = false;
                    calendarContainer.classList.remove('grabbing');
                }
                if (e.touches.length < 2) {
                    initialDistance = null; // Reset pinch state if less than 2 fingers
                    touchStartCenter = null;
                }
                // If all touches end, ensure grabbing cursor is removed
                if (e.touches.length === 0) {
                    calendarContainer.classList.remove('grabbing');
                }
            });

        } else {
            console.error("Could not find all required elements for calendar interaction.");
        }

        // Function to render the year selection chips
        function renderYearChips(yearsData, totalContributions) {
            const chipsContainer = document.getElementById('year-chips-container');
            if (!chipsContainer || !yearsData) {
                if (chipsContainer) chipsContainer.innerHTML = '<p class="text-xs text-yellow-400">Could not render year selectors.</p>';
                return;
            }

            chipsContainer.innerHTML = ''; // Clear previous chips/loading text

            // Add Total Chip
            const totalChip = document.createElement('span');
            totalChip.className = 'year-chip total';
            totalChip.textContent = `Total: ${totalContributions.toLocaleString()}`;
            chipsContainer.appendChild(totalChip);

            // Add Year Chips
            const sortedYears = yearsData.sort((a, b) => parseInt(b.year) - parseInt(a.year));

            if (window.selectedContributionYear === null && sortedYears.length > 0) {
                window.selectedContributionYear = sortedYears[0].year; // Default to latest year
            }

            sortedYears.forEach(yearData => {
                const yearChip = document.createElement('button');
                yearChip.className = 'year-chip';
                yearChip.textContent = `${yearData.year}: ${yearData.total.toLocaleString()}`;
                yearChip.dataset.year = yearData.year;
                if (yearData.year === window.selectedContributionYear) {
                    yearChip.classList.add('selected');
                }
                yearChip.addEventListener('click', () => {
                    if (window.selectedContributionYear !== yearData.year) { // Prevent re-render if already selected
                        window.selectedContributionYear = yearData.year;
                        renderYearChips(yearsData, totalContributions); // Update chip styles
                        renderContributionGrid(window.selectedContributionYear, window.currentContributionData.contributions); // Update grid
                    }
                });
                chipsContainer.appendChild(yearChip);
            });
        }


        // --- Main Data Fetching Logic ---
        async function fetchAllData() {
            const fieldsToLoad = ['profile-name', 'profile-bio', 'commits-count', 'owned-repo-count', 'contributed-repos-count', 'pr-count', 'issues-count', 'followers-count', 'footer-name'];
            fieldsToLoad.forEach(id => updateText(id, '...', true));
            updateText('last-updated', 'Last updated: Loading...', true);
            document.getElementById('language-stats-container').innerHTML = '<p class="text-sm text-gray-400 loading-placeholder">Loading language data...</p>';
            // Set initial loading state for contribution section placeholders
            // Update loading text reference
            const loadingText = document.getElementById('calendar-loading-text');
            if (loadingText) loadingText.style.display = 'block'; // Make sure it's visible
            document.getElementById('year-chips-container').innerHTML = '<p class="loading-placeholder text-gray-400 text-xs">Loading years...</p>';


            if (!gasWebAppUrl || gasWebAppUrl === 'YOUR_GAS_WEB_APP_URL') {
                console.error("GAS Web App URL is not set.");
                fieldsToLoad.forEach(id => updateText(id, 'Error', false));
                updateText('last-updated', 'Error: Config missing', false);
                document.getElementById('contribution-calendar-container').innerHTML = '<p class="text-red-400">Error: GAS URL not configured.</p>';
                return;
            }

            try {
                const response = await fetch(gasWebAppUrl);
                if (!response.ok) { const errorText = await response.text(); throw new Error(`GAS Fetch Error: ${response.status} ${response.statusText} - ${errorText}`); }
                const stats = await response.json();
                if (stats.error) { throw new Error(`GAS Script Error: ${stats.error} ${stats.details || ''}`); }
                // console.log("Stats received from GAS:", stats);

                // Update standard stats elements
                updateText('profile-name', stats.userName, false);
                updateText('profile-bio', stats.userBio || 'Bio not available.', false);
                updateImage('profile-pic', stats.userAvatarUrl);
                updateText('commits-count', stats.commitsCount, false);
                updateText('owned-repo-count', stats.ownedRepoCount, false);
                updateText('contributed-repos-count', stats.contributedReposCount, false);
                updateText('pr-count', stats.prCount, false);
                updateText('issues-count', stats.issuesCount, false);
                updateText('followers-count', stats.followers, false);
                // updateText('gists-count', stats.publicGists, false);
                renderLanguageStats(stats.languages);
                updateText('footer-name', stats.userName, false);
                if (stats.lastUpdated) { const date = new Date(stats.lastUpdated); updateText('last-updated', `Stats last updated: ${date.toLocaleString()}`, false); }
                else { updateText('last-updated', 'Stats last updated: N/A', false); }
                document.getElementById('github-link').href = `https://github.com/${githubUsername}`;
                document.getElementById('x-link').href = `https://x.com/${githubUsername}`; // Update X link too

                // Process and render contribution chart using data fetched via GAS
                const contribContainer = document.getElementById('contribution-calendar-container'); // Refetch container just in case
                const gridPlaceholder = document.getElementById('calendar-grid-placeholder');
                const chipsContainer = document.getElementById('year-chips-container');

                if (stats.contributionData && !stats.contributionData.error && Array.isArray(stats.contributionData.years) && Array.isArray(stats.contributionData.contributions)) {
                    window.currentContributionData = stats.contributionData; // Store full data
                    const years = stats.contributionData.years;
                    const contributions = stats.contributionData.contributions;
                    const totalContributions = years.reduce((sum, year) => sum + year.total, 0);

                    if (years.length > 0) {
                        // Set default year if not set
                        if (window.selectedContributionYear === null) {
                            window.selectedContributionYear = years.sort((a, b) => parseInt(b.year) - parseInt(a.year))[0].year;
                        }
                        renderYearChips(years, totalContributions); // Render chips
                        // Render the grid for the selected (or default) year
                        // This will also trigger fitGridToViewport via requestAnimationFrame
                        renderContributionGrid(window.selectedContributionYear, contributions);
                    } else {
                        if (loadingText) loadingText.textContent = 'No contribution year data available.';
                        if (chipsContainer) chipsContainer.innerHTML = '';
                    }
                } else {
                    console.warn("Contribution data missing or error from GAS response:", stats.contributionData?.error);
                    const errorMsg = stats.contributionData?.error ? `: ${stats.contributionData.error}` : '.';
                    if (loadingText) loadingText.textContent = `Could not load contribution data${errorMsg}`;
                    if (chipsContainer) chipsContainer.innerHTML = ''; // Clear chips on error
                }

            } catch (error) {
                console.error("Failed to fetch or process stats from GAS:", error);
                fieldsToLoad.forEach(id => updateText(id, 'Error', false));
                document.getElementById('language-stats-container').innerHTML = '<p class="text-sm text-red-400">Error loading language data.</p>';
                updateText('last-updated', 'Last updated: Error', false);
                // Update error message location
                const loadingText = document.getElementById('calendar-loading-text');
                if (loadingText) loadingText.textContent = `Error loading page data: ${error.message}`;
                const chipsContainer = document.getElementById('year-chips-container');
                if (chipsContainer) chipsContainer.innerHTML = ''; // Clear chips on error
            }
        }

        // Fetch data on load
        document.addEventListener('DOMContentLoaded', fetchAllData);

    </script>

</body>

</html>